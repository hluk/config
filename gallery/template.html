<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style>
#imglist {
position:absolute;
width:200px;
top:190px;
left:-210px;
background-color:rgba(0,0,0,0.5); 
padding:10px;
-moz-border-radius: 10px;
-webkit-border-radius: 10px;
}
#imglist:hover {left:-8px;}
.imgitem, #default {overflow: hidden; width: 185px; text-align: left; font-size: 0.7em; display:block; padding: 6px; font-weight: bold;}
.imgitem {cursor: pointer;}

* {margin: 0;font-family: Aller, Verdana, Arial, Helvetica; font-size: 16px; color: #ddd;}
body {text-align: center; background-color: #222;}
#info {margin: 5 10; position: absolute; top: 0; left: 0; text-shadow: #000 1px 1px 1px;}
#counter, #resolution {color: white; font-size: 0.7em; font-weight: bold;}
#imgtitle {margin: 0 5;}
#loading {color: #fd0; font-size: inherit; font-weight: bold;}
a, .imgitem {color: #7bf; text-decoration: none; font-weight: bold;}
a:hover, .imgitem:hover {color: #ff0;}
a:visited {color: #7bf;}
a:visited:hover {color: #ff0;}
</style>
<script type="text/javascript" src="http://script.aculo.us/prototype.js"></script>
<script type="text/javascript" src="http://script.aculo.us/effects.js"></script>
<script type="text/javascript"> 
// drag scroll (pan)
window.addEventListener("load",function() {
  var x,y;
  
  document.addEventListener("mousedown",startDragScroll,false);
  document.addEventListener("mouseup",stopDragScroll,false);
  document.addEventListener("mousemove",dragScroll,false);

  function startDragScroll(e){
    if (e.button == 0 && e.target.name == "myimage") {
      x = window.pageXOffset + e.clientX;  
      y = window.pageYOffset + e.clientY;
      e.stop();
    }
  }

  function stopDragScroll(e){ 
    x = false;
  }

  function dragScroll(e) {
    if (x) {
      window.scroll(x-e.clientX,y-e.clientY);
      e.stop();
    }
  }
},false);

// zoom image
function zoom(){
	if (!document.all&&!document.getElementById)
		return;

	img = document.images["myimage"];

	ww = window.innerWidth;
	wh = window.innerHeight;

	if ( zoom_state == "fit" )
		if (w > ww || h > wh)
			zoom_factor = ( ww*h < wh*w ) ? ww/w : wh/h;
		else
			zoom_factor = 1;
	else if ( zoom_state == "fill" )
			zoom_factor = ( ww*h < wh*w ) ? wh/h : ww/w;

	img.style.width  = w*zoom_factor;
	img.style.height = h*zoom_factor;
}

// keys
function keyDown(e){
	var keycode = e.which;
	var keyname;

	switch ( keycode ) {
	case 37:
		keyname = "Left";
		break;
	case 38:
		keyname = "Up";
		break;
	case 39:
		keyname = "Right";
		break;
	case 40:
		keyname = "Down";
		break;
	case 33:
		keyname = "PageUp";
		break;
	case 34:
		keyname = "PageDown";
		break;
	default:
		keyname = String.fromCharCode(keycode);
		break;
	}

	switch (keyname) {
	case "Left":
		window.scrollBy(-window.innerWidth/4,0);
		break;
	case "Up":
		window.scrollBy(0,-window.innerHeight/4);
		break;
	case "Right":
		window.scrollBy(window.innerWidth/4,0);
		break;
	case "Down":
		window.scrollBy(0,window.innerHeight/4);
		break;
	case "PageUp":
		window.scrollBy(0,-window.innerHeight);
		break;
	case "PageDown":
		window.scrollBy(0,window.innerHeight);
		break;
	case "a":
		go(len);
		break;
	case "b":
		window.scrollBy(0,window.innerHeight/4);
		break;
	case "c":
		go(n+5);
		break;
	case "d":
		go(n-1);
		break;
	case "f":
		go(n+1);
		break;
	case "g":
		go(1);
		break;
	case "h":
		window.scrollBy(0,-window.innerHeight/4);
		break;
	case "i":
		go(n-5);
		break;
	case "k":
		zoom_state = null;
		zoom_factor += zoom_step;
		zoom();
		break;
	case "m":
		zoom_state = null;
		zoom_factor -= zoom_step;
		zoom();
		break;
	case "j":
		zoom_state = null;
		zoom_factor = 1;
		zoom();
		break;
	case "o":
		zoom_state = 'fit';
		zoom();
		break;
	case "n":
		zoom_state = 'fill';
		zoom();
		break;
	}
}

function getUrlVars() {
	var map = {};
	var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
		map[key] = value;
	});
	return map;
}

function img_create(src) {
    var img = document.createElement('img');
    img.src = src;
    img.id = "myimage";
    img.name = "myimage";
    img.onload = imgOnLoad;
    return img;
}

function imgOnLoad() {
	w = this.width;
	h = this.height;
	zoom(); // refresh zoom

	window.setTimeout("Effect.Fade('resolution',{duration:1});window.setTimeout(\"Element.hide('resolution');document.getElementById('resolution').innerText = w+'x'+h; Effect.Appear('resolution', {duration:0.5});\",1000);",20);
	
}

function getPage(i) {
	if (!i || i<1)
		return 1;
	else if (i > len)
		return len;
	else 
		return i;
}

function go(i) {
	var pg = getPage(i);
	if ( pg != n ) {
		Effect.Squish('info',{duration:5});
		document.navigation.n.value = pg;
		document.navigation.zoom.value = (zoom_state) ? zoom_state : zoom_factor;
		document.navigation.submit();
	}
}


function showImageInfo(target) {
	var info = document.createElement('div');
	var counter = document.createElement('span');
	var imgtitle = document.createElement('span');
	var resolution = document.createElement('span');

	info.id = "info";
	
	counter.id = "counter";
	counter.innerText = n + "/" + len;
	if (n == len) new Effect.Pulsate(counter,{pulses:10,duration:5});

	imgtitle.id = "imgtitle";
	var l = document.createElement('a');
	l.href = "imgs/" + imgpath;
	l.appendChild(document.createTextNode(imgname));
	imgtitle.appendChild(l);

	resolution.id = "resolution";
	var loading = document.createElement('span');
	loading.id = "loading";
	loading.innerText = "...loading...";
	resolution.appendChild(loading);

	info.appendChild(counter);
	info.appendChild(imgtitle);
	info.appendChild(resolution);
	target.appendChild(info);
}

function showImage(target) {
	var img = img_create("imgs/" + imgpath);
	target.appendChild(img);
}

//<BEGIN>
// image viewer variables:
// ls - list of images
//<END>
var len = ls.length;

// GET variables
var vars = getUrlVars();
// page number
var n = getPage( parseInt(vars["n"]) );
// image filename and path
var imgname = ls[n-1];
var imgpath = encodeURIComponent(imgname);
// zoom
var zoom_step   = 0.2;
var zoom_state  = vars["zoom"];
var zoom_factor;
if ( zoom_state != "fit" && zoom_state != "fill") {
	zoom_factor = parseFloat(zoom_state);
	if (!zoom_factor)
		zoom_factor = 1.0;
}

// image width and height
var w;
var h;
document.write('<title>'+imgname+'</title>');
</script> 
</head>
<body>
<script type="text/javascript">
document.body.style.overflow = 'hidden';
document.addEventListener("keydown", keyDown, false);

var b = document.getElementsByTagName('body')[0];

b.onload = function(){ showImageInfo(b); showImage(b); }

document.write(
	'<form name="navigation" method="get">'+
	'<input type="hidden" name="zoom" value="1" />'+
	'<input type="hidden" name="n" value="0" />'+
	'</form>');

// selection box {{{
var imglist = document.createElement("div");
imglist.id = "imglist";

var from = n-8;
var to = n+7;
if (from < 0) {
	to +=Â -from;
	if (to > len) to = len;
	from = 0;
}
else if (to > len) {
	from -= to-len;
	if (from < 0) from = 0;
	to = len;
}
var l;
if(from > 0)
	imglist.appendChild(document.createTextNode("..."));
for(var i=from; i<to; ++i) {
	var img = ls[i];
	if (i != n-1) {
		l = document.createElement('div');
		l.className = "imgitem";
		l.id = i+1;
		l.onclick = function() { document.navigation.n.value = this.id; document.navigation.submit(); }
		l.appendChild(document.createTextNode(img));
	}
	else {
		l = document.createElement('div');
		l.id = "default";
		l.appendChild(document.createTextNode(img));
	}
	imglist.appendChild(l);
}
if(to < len)
	imglist.appendChild(document.createTextNode("..."));

b.appendChild(imglist);
//}}}
</script>
</body>
</html>
